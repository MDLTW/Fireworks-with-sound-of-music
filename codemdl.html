<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="zh-TW"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;title&gt;å²è©©ç´šï¼1812åºæ›²ç…™ç«äº¤éŸ¿ç§€ (60ç§’å¾ªç’°)&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>canvas { display: block; background-color: #000; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>#sound-prompt {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>position: fixed; top: 0; left: 0; width: 100%; height: 100%;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>background: rgba(0,0,0,0.75); color: white; display: flex;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>justify-content: center; align-items: center; font-size: 2em;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>text-align: center; padding: 20px; box-sizing: border-box;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cursor: pointer; z-index: 10;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ğŸ†&lt;br&gt;é»æ“Šè¢å¹•ä»»ä½•åœ°æ–¹&lt;br&gt;é–‹å•Ÿè²éŸ³ä¸¦é–‹å§‹ç…™ç«äº¤éŸ¿ç§€ï¼</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;canvas id="fireworksCanvas"&gt;&lt;/canvas&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- è²éŸ³æª”æ¡ˆ --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- *** éå¸¸é‡è¦ï¼šç¢ºèª src è·¯å¾‘å’Œæª”åè·Ÿä½ ä¸Šå‚³çš„ä¸€æ¨£ï¼*** --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;audio id="bgMusic" src="audio/1812.mp3" preload="auto" loop&gt;&lt;/audio&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;audio id="fireworksSfxLoop" src="audio/190700.mp3" preload="auto" loop&gt;&lt;/audio&gt;</p>
<p class="p2"><br></p>                                <canvas id="fireworksCanvas"></canvas>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const canvas = document.getElementById('fireworksCanvas');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const ctx = canvas.getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let activeFireworks = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let vw, vh;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let mainLoopTimer = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let sequenceIndex = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let lastTime = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- è²éŸ³ç›¸é—œè®Šæ•¸ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let bgMusic;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let fireworksSfxLoop; // ç”¨ä¾†æ§åˆ¶ç…™ç«éŸ³æ•ˆå¾ªç’°</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let soundEnabled = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let soundPrompt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- æ ¸å¿ƒè¨­å®š ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const sequenceDuration = 60000;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const targetFireworksPerSequence = 800;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const gravity = 0.03;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const friction = 0.98;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const trailLength = 8;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- é¡è‰²åº« ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const colors = [ /* ... çœç•¥ï¼Œé¡è‰²åˆ—è¡¨å’Œä¹‹å‰ä¸€æ¨£ ... */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'#FF4848', '#FF7648', '#FFA548', '#FFD048', '#FFFF48',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'#48FFFF', '#48D1FF', '#48A5FF', '#4876FF', '#4848FF', '#7648FF',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'#48FF48', '#48FF76', '#48FFA5', '#48FFD1',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'#FF48FF', '#FF48D1', '#FF48A5', '#D148FF', '#A548FF',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'#FFFFFF', '#F0F0F0', '#FFD700'</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- ç…™ç«é¡å‹ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const fireworkTypes = [ /* ... çœç•¥ï¼Œé¡å‹åˆ—è¡¨å’Œä¹‹å‰ä¸€æ¨£ ... */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'sphere_mono', 'sphere_multi', 'sphere_rainbow',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'willow_gold', 'willow_multi',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'glitter_fast', 'glitter_dense',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'strobe_mono', 'strobe_multi',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'ring_simple',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'burst_directional',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'sphere_compact', 'sphere_large'</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- é ç”Ÿæˆåºåˆ— ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let fireworkSequence = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function generateSequence() { /* ... çœç•¥ï¼Œå…§å®¹å’Œä¹‹å‰ä¸€æ¨£ ... */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>console.log("Generating 60s firework sequence...");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>fireworkSequence = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (!vw || !vh) { resizeCanvas(); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>for (let i = 0; i &lt; targetFireworksPerSequence; i++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const launchTime = Math.random() * sequenceDuration;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const xPos = random(0.1, 0.9);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const type = fireworkTypes[Math.floor(Math.random() * fireworkTypes.length)];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const launchSpeed = random(-12, -16);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const targetHeightFactor = random(0.15, 0.5);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>fireworkSequence.push({</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>time: launchTime, x: xPos, type: type,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>launchSpeed: launchSpeed, targetHeightFactor: targetHeightFactor</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>fireworkSequence.sort((a, b) =&gt; a.time - b.time);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>console.log(`Generated ${fireworkSequence.length} firework events.`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>sequenceIndex = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- è¼”åŠ©å‡½æ•¸ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function random(min, max) { /* ... çœç•¥ ... */ return Math.random() * (max - min) + min; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function randomInt(min, max) { /* ... çœç•¥ ... */ return Math.floor(random(min, max + 1)); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function randomColor(palette = colors) { /* ... çœç•¥ ... */ return palette[Math.floor(Math.random() * palette.length)]; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function getColors(type) { /* ... çœç•¥ï¼Œå…§å®¹å’Œä¹‹å‰ä¸€æ¨£ ... */</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>let count = randomInt(1,3);</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>let palette = colors;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>if (type.includes('mono')) count = 1;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>if (type.includes('multi')) count = randomInt(2, 4);</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>if (type.includes('rainbow')) return ['#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#4B0082', '#8B00FF'];</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>if (type.includes('gold')) return ['#FFD700', '#FFA500', '#F0E68C'];</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>const shuffled = palette.slice().sort(() =&gt; 0.5 - Math.random());</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>return shuffled.slice(0, count);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- ç²’å­é¡åˆ¥ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>class Particle { /* ... çœç•¥ï¼Œå…§å®¹å’Œä¹‹å‰ä¸€æ¨£ ... */</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>constructor(x, y, vx, vy, color, life, particleType = 'normal', options = {}) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.x = x; this.y = y; this.vx = vx; this.vy = vy; this.color = color;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.initialLife = life &gt; 0 ? life : 0.1; this.life = this.initialLife; this.alpha = 1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.type = particleType; this.gravity = gravity * (options.gravityFactor || 1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.friction = options.friction || friction; this.strobeRate = options.strobeRate || 0.1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.strobeIntensity = options.strobeIntensity || 0.5; this.radius = options.radius || random(1.5, 2.5);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.decay = random(0.01, 0.02) * (options.decayRate || 1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (this.decay * (16.67) &gt;= this.life) { this.decay = this.life / 20 ; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>update(deltaTime) { /* ... çœç•¥ï¼Œå…§å®¹å’Œä¹‹å‰ä¸€æ¨£ ... */</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>if (isNaN(deltaTime) || deltaTime &lt;= 0) deltaTime = 16.67;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>const dt = deltaTime / 16.67;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>this.x += this.vx * dt; this.y += this.vy * dt; this.vy += this.gravity * dt;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>this.vx *= Math.pow(this.friction, dt); this.vy *= Math.pow(this.friction, dt);</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>this.life -= this.decay * dt;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>if (this.type === 'strobe') { /* ... strobe alpha logic ... */</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (Math.random() &lt; this.strobeRate) { this.alpha = random(1 - this.strobeIntensity, 1); }</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else { const baseAlpha = this.initialLife &gt; 0 ? Math.max(0, this.life / (this.initialLife * 0.5)) : 0; this.alpha = baseAlpha; }</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>this.alpha = Math.max(0, Math.min(1, this.alpha));</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>} else { this.alpha = this.initialLife &gt; 0 ? Math.max(0, this.life / this.initialLife) : 0; }</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>this.alpha = Math.max(0, this.alpha);</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>draw() { /* ... çœç•¥ï¼Œå…§å®¹å’Œä¹‹å‰ä¸€æ¨£ ... */</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.globalAlpha = this.alpha; ctx.fillStyle = this.color; ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.arc(this.x, this.y, this.radius * this.alpha + 0.5, 0, Math.PI * 2); ctx.fill();</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>shouldRemove() { /* ... çœç•¥ï¼Œå…§å®¹å’Œä¹‹å‰ä¸€æ¨£ ... */ return this.life &lt;= 0 || this.alpha &lt;= 0.01; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- ç…™ç«é¡åˆ¥ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>class Firework {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>constructor(startX, targetY, launchSpeed, type) { // *** æ³¨æ„ï¼šæ¥æ”¶çš„æ˜¯è¨ˆç®—å¥½çš„ targetY ***</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.startX = startX;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.targetHeight = targetY; // ç›´æ¥ä½¿ç”¨å‚³å…¥çš„çµ•å°é«˜åº¦</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.type = type;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.exploded = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.particles = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.rocket = { x: startX, y: vh, vx: random(-1, 1), vy: launchSpeed, alpha: 1, color: 'rgba(255,255,255,0.5)' };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.trailParticles = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.explosionParams = this.getExplosionParams(type);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.explosionColors = getColors(type);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>getExplosionParams(type) { /* ... çœç•¥ï¼Œå…§å®¹å’Œä¹‹å‰ä¸€æ¨£ ... */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let params = { /* ... defaults ... */ count: randomInt(80, 150), speed: random(3, 8), life: random(0.8, 1.8), particleType: 'normal', gravityFactor: 1, radius: random(1.5, 2.5), decayRate: 1, shape: 'sphere', angleRange: [0, Math.PI * 2] };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (type.includes('willow')) { /* ... */ params.count = randomInt(60, 120); params.speed = random(1, 4); params.life = random(2.0, 3.5); params.gravityFactor = 1.2; params.decayRate = 0.8; params.radius = random(1, 2); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (type.includes('glitter')) { /* ... */ params.count = randomInt(150, 300); params.speed = random(4, 9); params.life = random(0.3, 0.8); params.decayRate = 1.5; params.radius = random(0.8, 1.5); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (type.includes('strobe')) { /* ... */ params.particleType = 'strobe'; params.life = random(0.6, 1.5); params.strobeRate = 0.2; params.strobeIntensity = 0.6; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (type.includes('ring')) { /* ... */ params.shape = 'ring'; const ringStart = Math.random() * Math.PI * 2; const ringWidth = random(Math.PI * 0.1, Math.PI * 0.3); params.angleRange = [ringStart, ringStart + ringWidth]; params.count = randomInt(100, 180); params.speed = random(4, 7); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (type.includes('directional')) { /* ... */ params.shape = 'directional'; const direction = Math.random() * Math.PI * 2; const spread = random(Math.PI * 0.3, Math.PI * 0.8); params.angleRange = [direction - spread / 2, direction + spread / 2]; params.speed = random(6, 11); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(type.includes('compact')) { /* ... */ params.speed = random(2, 5); params.life = random(0.6, 1.2); params.count = randomInt(60,100); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(type.includes('large')) { /* ... */ params.speed = random(5, 10); params.life = random(1.5, 2.5); params.count = randomInt(120, 200); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return params;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>update(deltaTime) { // *** å…§å®¹ä¸è®Šï¼Œä½†ä¸å†éœ€è¦å¾é€™è£¡è§¸ç™¼éŸ³æ•ˆ ***</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const dt = deltaTime / 16.67;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (!this.exploded) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>this.rocket.x += this.rocket.vx * dt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>this.rocket.y += this.rocket.vy * dt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>this.rocket.vy += gravity * dt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(Math.random() &lt; 0.5) { /* ... trail particle push ... */ this.trailParticles.push(new Particle( this.rocket.x, this.rocket.y, random(-0.3, 0.3), random(-0.3, 0.3), this.rocket.color, random(0.3, 0.7), 'normal', { radius: 1.5, decayRate: 1.8 } )); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (this.rocket.y &lt;= this.targetHeight || this.rocket.vy &gt;= -1) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>this.explode(); // åªè§¸ç™¼è¦–è¦ºçˆ†ç‚¸</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>this.particles.forEach((p, i) =&gt; { p.update(deltaTime); if (p.shouldRemove()) this.particles.splice(i, 1); });</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>this.trailParticles.forEach((p, i) =&gt; { p.update(deltaTime); if (p.shouldRemove()) this.trailParticles.splice(i, 1); });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>explode() { // *** ä¸å†éœ€è¦æ’­æ”¾éŸ³æ•ˆçš„ç¨‹å¼ç¢¼ ***</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (this.exploded) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.exploded = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.rocket.alpha = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const explosionX = this.rocket.x;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const explosionY = this.rocket.y;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const params = this.explosionParams;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>for (let i = 0; i &lt; params.count; i++) { /* ... åŸæœ¬çš„ç²’å­ç”Ÿæˆé‚è¼¯ ... */</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let angle; /* ... calculate angle ... */</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (params.shape === 'sphere') { angle = Math.random() * Math.PI * 2; } else if (params.shape === 'ring') { angle = params.angleRange[0] + Math.random() * (params.angleRange[1] - params.angleRange[0]); /* ... wrap around logic ... */ } else if (params.shape === 'directional') { angle = params.angleRange[0] + Math.random() * (params.angleRange[1] - params.angleRange[0]); } else { angle = Math.random() * Math.PI * 2; }</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const speed = random(0.5, 1.0) * params.speed * (Math.random() &gt; 0.9 ? 1.5 : 1);</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const vx = Math.cos(angle) * speed; const vy = Math.sin(angle) * speed;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const color = this.explosionColors.length &gt; 0 ? this.explosionColors[i % this.explosionColors.length] : randomColor();</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const life = random(0.8, 1.2) * params.life;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>this.particles.push(new Particle( explosionX, explosionY, vx, vy, color, life, params.particleType, { /* ... options ... */ gravityFactor: params.gravityFactor, radius: params.radius, decayRate: params.decayRate, strobeRate: params.strobeRate, strobeIntensity: params.strobeIntensity } ));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>this.trailParticles.forEach(p =&gt; { p.life *= 0.5; });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>draw() { /* ... çœç•¥ï¼Œå…§å®¹å’Œä¹‹å‰ä¸€æ¨£ ... */</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.globalAlpha = 0.6; this.trailParticles.forEach(p =&gt; p.draw());</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx.globalAlpha = 1; this.particles.forEach(p =&gt; p.draw()); ctx.globalAlpha = 1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>shouldRemove() { /* ... çœç•¥ï¼Œå…§å®¹å’Œä¹‹å‰ä¸€æ¨£ ... */</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>return this.exploded &amp;&amp; this.particles.length === 0 &amp;&amp; this.trailParticles.length === 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- ä¸»å‹•ç•«å¾ªç’° ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function animate(currentTime) {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>requestAnimationFrame(animate);</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>if (!lastTime) lastTime = currentTime;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>const deltaTime = currentTime - lastTime;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>lastTime = currentTime;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>if (isNaN(deltaTime) || deltaTime &lt;= 0 || deltaTime &gt; 100) { return; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>if (soundEnabled) { // *** è²éŸ³å•Ÿç”¨å¾Œæ‰è¨ˆæ™‚å’Œç™¼å°„ ***</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>mainLoopTimer += deltaTime;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// æª¢æŸ¥å¾ªç’°é‡ç½®</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (mainLoopTimer &gt;= sequenceDuration) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>console.log("å¾ªç’°æ’­æ”¾...");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>mainLoopTimer %= sequenceDuration;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>sequenceIndex = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>// *** é‡ç½®å…©ç¨®è²éŸ³çš„æ™‚é–“ ***</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (bgMusic) {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>try { bgMusic.currentTime = 0; if(bgMusic.paused){bgMusic.play();} }</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>catch (e) { console.warn("ç„¡æ³•é‡ç½®èƒŒæ™¯éŸ³æ¨‚:", e); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (fireworksSfxLoop) {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>try { fireworksSfxLoop.currentTime = 0; if(fireworksSfxLoop.paused){fireworksSfxLoop.play();} }</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>catch (e) { console.warn("ç„¡æ³•é‡ç½®ç…™ç«éŸ³æ•ˆ:", e); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// --- ç™¼å°„ç…™ç« ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>while (sequenceIndex &lt; fireworkSequence.length &amp;&amp; fireworkSequence[sequenceIndex].time &lt;= mainLoopTimer) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const event = fireworkSequence[sequenceIndex];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const xPos = event.x * vw;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const targetY = vh * event.targetHeightFactor; // è¨ˆç®—çµ•å°é«˜åº¦</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (xPos &gt; 0 &amp;&amp; xPos &lt; vw) {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>activeFireworks.push(new Firework(xPos, targetY, event.launchSpeed, event.type)); // å‚³å…¥ targetY</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>sequenceIndex++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>} // &lt;--- soundEnabled åˆ¤æ–·çµæŸ</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// --- ç¹ªåœ– ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ctx.fillStyle = `rgba(0, 0, 0, ${trailLength / 100})`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ctx.globalCompositeOperation = 'source-over';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ctx.fillRect(0, 0, vw, vh);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ctx.globalCompositeOperation = 'lighter';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>for (let i = activeFireworks.length - 1; i &gt;= 0; i--) {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>activeFireworks[i].update(deltaTime); activeFireworks[i].draw();</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>if (activeFireworks[i].shouldRemove()) { activeFireworks.splice(i, 1); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ctx.globalCompositeOperation = 'source-over'; ctx.globalAlpha = 1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- åˆå§‹åŒ–è²éŸ³ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function initAudio() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>soundPrompt = document.getElementById('sound-prompt');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>bgMusic = document.getElementById('bgMusic');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>fireworksSfxLoop = document.getElementById('fireworksSfxLoop'); // å–å¾—ç…™ç«éŸ³æ•ˆå…ƒç´ </p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (bgMusic) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>bgMusic.volume = 1.0; // èƒŒæ™¯éŸ³æ¨‚éŸ³é‡æœ€å¤§</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>console.log("èƒŒæ™¯éŸ³æ¨‚å…ƒç´ æ‰¾åˆ°ï¼ŒéŸ³é‡è¨­å®šç‚º 1.0");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>console.error("æ‰¾ä¸åˆ°èƒŒæ™¯éŸ³æ¨‚å…ƒç´  #bgMusic");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (fireworksSfxLoop) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>fireworksSfxLoop.volume = 1.0; // ç…™ç«éŸ³æ•ˆéŸ³é‡æœ€å¤§</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>console.log("ç…™ç«éŸ³æ•ˆå…ƒç´ æ‰¾åˆ°ï¼ŒéŸ³é‡è¨­å®šç‚º 1.0");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>console.error("æ‰¾ä¸åˆ°ç…™ç«éŸ³æ•ˆå…ƒç´  #fireworksSfxLoop");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// ç›£è½é»æ“Šä»¥å•Ÿç”¨è²éŸ³</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>soundPrompt.addEventListener('click', enableSound, { once: true });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- å•Ÿç”¨è²éŸ³çš„å‡½æ•¸ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function enableSound() {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>if (soundEnabled) return;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>console.log("è²éŸ³å·²ç”±ä½¿ç”¨è€…äº’å‹•å•Ÿç”¨ã€‚");</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>soundEnabled = true;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>soundPrompt.style.display = 'none';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>// *** å˜—è©¦åŒæ™‚æ’­æ”¾å…©ç¨®è²éŸ³ ***</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>const playPromises = []; // ç”¨ä¾†æ”¶é›†æ’­æ”¾çš„ Promise</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>if (bgMusic) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>playPromises.push(bgMusic.play());</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>if (fireworksSfxLoop) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>playPromises.push(fireworksSfxLoop.play());</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>// ç­‰å¾…æ‰€æœ‰è²éŸ³éƒ½å˜—è©¦é–‹å§‹æ’­æ”¾å¾Œï¼Œå†åŒæ­¥è¨ˆæ™‚å™¨</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>Promise.all(playPromises)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>.then(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>console.log("èƒŒæ™¯éŸ³æ¨‚å’Œç…™ç«éŸ³æ•ˆå˜—è©¦é–‹å§‹æ’­æ”¾ã€‚");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>// è²éŸ³æˆåŠŸé–‹å§‹ (æˆ–å˜—è©¦é–‹å§‹) å¾Œï¼Œé‡ç½®è¨ˆæ™‚å™¨</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>mainLoopTimer = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>sequenceIndex = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>lastTime = performance.now(); // ä½¿ç”¨ performance.now() ç²å–æ›´ç²¾ç¢ºçš„èµ·å§‹æ™‚é–“</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>console.log("ä¸»å¾ªç’°è¨ˆæ™‚å™¨å·²é‡ç½®èˆ‡è²éŸ³åŒæ­¥ã€‚");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>})</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>.catch(e =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>// å³ä½¿æœ‰éŒ¯èª¤ä¹Ÿè¦é‡ç½®è¨ˆæ™‚å™¨ï¼Œé¿å…å®Œå…¨å¡ä½</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>console.error("è‡³å°‘ä¸€å€‹è²éŸ³æ’­æ”¾å¤±æ•—:", e);</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>mainLoopTimer = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>sequenceIndex = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>lastTime = performance.now();</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>console.warn("å„˜ç®¡è²éŸ³æ’­æ”¾å¤±æ•—ï¼Œä¸»å¾ªç’°è¨ˆæ™‚å™¨ä»å·²é‡ç½®ã€‚");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- é‡è¨­ç•«å¸ƒå¤§å°å‡½æ•¸ ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function resizeCanvas() { /* ... çœç•¥ï¼Œå…§å®¹å’Œä¹‹å‰ä¸€æ¨£ ... */</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>vw = canvas.width = window.innerWidth;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>vh = canvas.height = window.innerHeight;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- åˆå§‹åŒ–è¨­å®š ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function setup() {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>resizeCanvas();</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>generateSequence();</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>initAudio(); // åˆå§‹åŒ–è²éŸ³</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>requestAnimationFrame(animate); // å•Ÿå‹•ç¹ªåœ–å¾ªç’°</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>console.log("è¨­å®šå®Œæˆï¼Œç­‰å¾…ä½¿ç”¨è€…äº’å‹•ä»¥å•Ÿç”¨è²éŸ³ã€‚");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- äº‹ä»¶ç›£è½ (çª—å£å¤§å°æ”¹è®Š) ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let resizeTimeout;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.addEventListener('resize', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>clearTimeout(resizeTimeout);</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>resizeTimeout = setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>console.log("çª—å£å¤§å°æ”¹è®Š - é‡æ–°ç”Ÿæˆåºåˆ—...");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>resizeCanvas();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>generateSequence();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (soundEnabled) { // åªæœ‰è²éŸ³å•Ÿç”¨å¾Œæ‰é‡ç½®è¨ˆæ™‚å™¨å’Œè²éŸ³</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>mainLoopTimer = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>lastTime = performance.now();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>sequenceIndex = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (bgMusic &amp;&amp; !bgMusic.paused) { bgMusic.currentTime = 0; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (fireworksSfxLoop &amp;&amp; !fireworksSfxLoop.paused) { fireworksSfxLoop.currentTime = 0; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>}, 500);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// å•Ÿå‹•ï¼</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>setup();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
